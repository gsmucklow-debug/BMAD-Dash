---
epic_id: "epic-5"
epic_title: "AI Coach Integration"
status: "review-failed"
review_date: "2026-01-12"
participants:
  - Gary (Project Lead)
  - Bob (Scrum Master)
  - Alice (Product Owner)
  - Charlie (Senior Dev)
  - Dana (QA Engineer)
metrics:
  stories_completed: 4
  stories_accepted: 2 # 5.1, 5.3 accepted. 5.2, 5.4 failed validation.
  performance_target_met: false # 2.6s latency observed vs <500ms target
---

# Retrospective: Epic 5 - AI Coach Integration

## ðŸš¨ Critical Failures Detected

Despite all stories being marked "done," user verification revealed two critical system failures:

1.  **Context Injection Failure (AI Lobotomy):**
    *   The AI Coach "has no idea" about the project state.
    *   When asked about specific stories (e.g., "Story 3.2"), it fails to retrieve context.
    *   **Impact:** The "Project-Aware" promise of Story 5.2 is unfulfilled.

2.  **Performance & Caching Failure:**
    *   **Evidence:** User provided logs showing `TestDiscoverer` and `GitCorrelator` running *per request* for every story.
    *   **Latency:** Observed `2667.69ms` for a single evidence check.
    *   **Architecture Violation:** The Dashboard is making N+1 API calls (one per story evidence) instead of loading the unified `project-state.json` cache.
    *   **Impact:** Dashboard startup is slow, violating NFRs.

## Successes
*   **chat UI (Story 5.1):** The streaming interface works.
*   **Validation Service (Story 5.3):** The logic to check for gaps exists (even if performance is poor).

## Root Cause Analysis
*   **Testing Gap:** QA verified that `project-state.json` *could* be created, but did not verify that the Dashboard *actually used it* to replace individual API calls.
*   **Integration Gap:** The frontend likely still requests `/api/git-evidence/ID` for every card, bypassing the cache strategy entirely.
*   **Prompt Engineering:** The context injection into Gemini's system prompt is likely malformed, truncated, or missing.

## Action Plan
1.  **Create Critical Fix Story 5.5:** "Fix AI Context Injection & Enforce Caching Strategy".
2.  **Scope of Fix:**
    *   **Frontend:** Refactor Dashboard to load `project-state.json` ONCE and populate all evidence badges from that single payload. Stop calling `/api/git-evidence/*`.
    *   **Backend/AI:** Debug `_build_system_prompt` to ensure `project-state` is correctly injected and visible to Gemini.
3.  **Process Change:** Future performance stories must include a screenshot of the Network Tab or Server Logs proving the N+1 problem is solved.

## Conclusion
Epic 5 cannot be considered "Done" until these regressions are fixed. We are proceeding to Story 5.5 immediately.
